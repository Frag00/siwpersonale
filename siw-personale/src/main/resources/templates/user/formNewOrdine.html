<!DOCTYPE html>
<html>
 <head>
	 <title>New Review</title>
 </head>
 <body>	
	<h1><strong>SliceVerse</strong></h1>
	<div th:if="${user}">
				<p th:text="${user.nome + ' ' + user.cognome}"></p>
		  		<p><a href="/logout">Logout</a></p>
				<p><a th:href="@{/user/profile}">Profilo</a></p>
			</div>
    <h2>Nuovo Ordine - <span th:text="${pizzeria.nome}">Nome Pizzeria</span></h2>
    <p>Indirizzo: <span th:text="${pizzeria.indirizzo}">Indirizzo</span>, <span th:text="${pizzeria.citta}">Città</span></p>
    
    <!-- Form per aggiornare il riepilogo -->
    <form th:action="@{/user/pizzerie/{pId}/ordine/riepilogo(pId=${pizzeria.id})}" method="post">
        <input type="hidden" name="pizzeriaId" th:value="${pizzeria.id}" />
        
        <h3>Menu</h3>
        
		<div th:if="${!pizze.isEmpty()}">
			<h3>Pizze</h3>
			<div th:each="p : ${pizze}">
			    <h4 th:text="${p.nome}">Nome</h4>
			    <p th:text="${p.descrizione}"></p>
			    <p>Prezzo: <span th:text="${p.prezzo}"></span> €</p>
			    <div th:if="${p.immagine != null}">
			        <img th:src="${p.immagine.nome}" alt="Immagine prodotto" width="100" height="100">
			    </div>
			    <label th:for="'quantita_' + ${p.id}">Quantità:</label>
			    <input type="number" th:id="'quantita_' + ${p.id}" th:name="'quantita_' + ${p.id}" min="0" max="20">
			    <hr>
			</div>
		</div>
		
		<div th:if="${!fritti.isEmpty()}">
			<h3>Fritti</h3>
			<div th:each="f : ${fritti}">
			    <h4 th:text="${f.nome}">Nome</h4>
			    <p th:text="${f.descrizione}"></p>
			    <p>Prezzo: <span th:text="${f.prezzo}"></span> €</p>
			    <div th:if="${f.immagine != null}">
			        <img th:src="${f.immagine.nome}" alt="Immagine prodotto" width="100" height="100">
			    </div>
			    <label th:for="'quantita_' + ${f.id}">Quantità:</label>
			    <input type="number" th:id="'quantita_' + ${f.id}" th:name="'quantita_' + ${f.id}" min="0" max="20">
			    <hr>
			</div>
		</div>
		
		<div th:if="${!bevande.isEmpty()}">
			<h3>Bevande</h3>
			<div th:each="b : ${bevande}">
			    <h4 th:text="${b.nome}">Nome</h4>
			    <p th:text="${b.descrizione}"></p>
			    <p>Prezzo: <span th:text="${b.prezzo}"></span> €</p>
			    <div th:if="${b.immagine != null}">
			        <img th:src="${b.immagine.nome}" alt="Immagine prodotto" width="100" height="100">
			    </div>
			    <label th:for="'quantita_' + ${b.id}">Quantità:</label>
			    <input type="number" th:id="'quantita_' + ${b.id}" th:name="'quantita_' + ${b.id}" min="0" max="20">
			    <hr>
			</div>
		</div>
        
        <button type="submit">Aggiorna Riepilogo</button>
    </form>
    
    <!-- Riepilogo Ordine -->
    <div th:if="${riepilogo != null and !riepilogo.empty}">
        <h3>Riepilogo Ordine</h3>
        <table border="1">
            <thead>
                <tr>
                    <th>Prodotto</th>
                    <th>Quantità</th>
                    <th>Prezzo Unitario</th>
                    <th>Subtotale</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="riga : ${riepilogo}">
                    <td th:text="${riga.prodotto.nome}">Nome Prodotto</td>
                    <td th:text="${riga.quantita}">1</td>
                    <td>€<span th:text="${riga.prodotto.prezzo}">0.00</span></td>
                    <td>€<span th:text="${#numbers.formatDecimal(riga.prodotto.prezzo * riga.quantita, 1, 2)}">0.00</span></td>
                </tr>
            </tbody>
        </table>
        
        <p><strong>Totale: €<span th:text="${#numbers.formatDecimal(totale, 1, 2)}">0.00</span></strong></p>
        
        <!-- Form per confermare l'ordine -->
        <form th:action="@{/user/pizzerie/{pId}/addOrdine(pId=${pizzeria.id})}" method="post">
            <input type="hidden" name="pizzeriaId" th:value="${pizzeria.id}" />
            
            <!-- Campi hidden per mantenere le quantità -->
            <div th:each="prodotto : ${pizzeria.menu}">
                <input type="hidden" 
                       th:name="'quantita_' + ${prodotto.id}"
                       th:value="${quantita != null ? quantita.get(prodotto.id) : 0}">
            </div>
            
			
			<label for="indirizzoConsegna">Indirizzo di consegna:</label>
			<input type="text" id="indirizzoConsegna" name="indirizzoConsegna" required>

			<label for="orarioConsegna">Orario di consegna:</label>
			<input type="time" id="orarioConsegna" name="orarioConsegna" required>
			
            <button type="submit">Conferma Ordine</button>
        </form>
    </div>
    
    <div th:if="${riepilogo == null or riepilogo.empty}">
        <p>Seleziona i prodotti e clicca "Aggiorna Riepilogo" per vedere il riepilogo dell'ordine</p>
    </div>
	
	<div th:if="${success}" class="alert alert-success">
	    <p th:text="${success}"></p>
	</div>
	<div th:if="${error}" class="alert alert-danger">
	    <p th:text="${error}"></p>
	</div>
	
	<p><a href="/user/pizzerie">Torna alla lista di tutte le Pizzerie</a></p>
	 <p><a href="/user">Torna alla home</a></p>
</body>
</html>